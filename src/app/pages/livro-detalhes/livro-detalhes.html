<div class="detalhes-container" *ngIf="livro; else carregando">
  <!-- Mensagem de sucesso -->
  <div class="alert-success" *ngIf="mensagemSucesso">
    {{ mensagemSucesso }}
  </div>

  <div class="voltar-link">
    <a routerLink="/loja">← Voltar para a loja</a>
  </div>

  <div class="livro-content">
    
    <div class="livro-imagem">
      <img [src]="livro.capa_url || 'assets/placeholder.png'" [alt]="livro.titulo" [title]="livro.titulo">
    </div>

    <div class="livro-info">
      <h1>{{ livro.titulo }}</h1>
      <p class="autor"><strong>Autor:</strong> {{ livro.autor?.nome || 'Autor desconhecido' }}</p>
      
      <p class="preco" *ngIf="livro.estoque?.preco">R$ {{ livro.estoque.preco | number:'1.2-2' }}</p>
      <p class="preco" *ngIf="!livro.estoque?.preco">Preço sob consulta</p>
      
      <div class="botoes-acao">
        <button class="btn-adicionar" (click)="adicionarAoCarrinho()" [title]="'Adicionar ' + livro.titulo + ' ao carrinho'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 18C5.9 18 5.01 18.9 5.01 20C5.01 21.1 5.9 22 7 22C8.1 22 9 21.1 9 20C9 18.9 8.1 18 7 18ZM1 2V4H3L6.6 11.59L5.25 14.04C5.09 14.32 5 14.65 5 15C5 16.1 5.9 17 7 17H19V15H7.42C7.28 15 7.17 14.89 7.17 14.75L7.2 14.63L8.1 13H15.55C16.3 13 16.96 12.59 17.3 11.97L20.88 5.48C20.96 5.34 21 5.17 21 5C21 4.45 20.55 4 20 4H5.21L4.27 2H1ZM17 18C15.9 18 15.01 18.9 15.01 20C15.01 21.1 15.9 22 17 22C18.1 22 19 21.1 19 20C19 18.9 18.1 18 17 18Z" fill="currentColor"/>
          </svg>
          Adicionar ao carrinho
        </button>
      </div>

      <div class="detalhes-tecnicos">
        <p><strong>Editora:</strong> {{ livro.editora || 'Não informada' }}</p>
        <p><strong>ISBN:</strong> {{ livro.isbn || 'Não informado' }}</p>
        <p><strong>Gênero:</strong> {{ livro.genero?.nome || 'Não informado' }}</p>
        <p><strong>Ano:</strong> {{ livro.ano_publicacao || 'Não informado' }}</p>
      </div>
      
      <div class="sinopse">
        <h2>Sinopse</h2>
        <p>{{ livro.sinopse || 'Sinopse não disponível.' }}</p>
      </div>
    </div>
  </div>

  <div class="resenhas-section">
    <h2>Resenhas</h2>
    
    <div *ngIf="avaliacoes.length > 0; else noAvaliacoes" class="lista-avaliacoes">
      <div *ngFor="let avaliacao of avaliacoes" class="resenha-item">
        <p><strong>{{ avaliacao.autor?.nome || 'Usuário' }} (Nota: {{ avaliacao.nota }})</strong></p>
        <p>{{ avaliacao.comentario }}</p>
      </div>
    </div>
    <ng-template #noAvaliacoes>
      <p>Este livro ainda não tem avaliações. Seja o primeiro!</p>
    </ng-template>

    <hr>
    
    <app-avaliacao-form 
      [idLivro]="livroId" 
      (avaliacaoSalva)="onNovaAvaliacao($event)">
    </app-avaliacao-form>
  </div>
</div>

<ng-template #carregando>
  <p class="loading">Carregando detalhes do livro...</p>
</ng-template>